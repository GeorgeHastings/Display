"use strict";function callAjax(e,t){var n=new XMLHttpRequest;n.onload=t,n.open("GET","http://localhost:1235/api/teammembers?limit=10&offset=0&email="+e+"%40ideo.com"),n.send()}function getEventDay(e){var t;return t=e.start.dateTime?e.start.dateTime:e.start.date,moment(t)}function getDisplayTime(e){if(e.start.dateTime){var t=moment(e.start.dateTime).format("ddd"),n=moment(e.start.dateTime).format("D"),r=moment(e.start.dateTime),o=moment(e.end.dateTime);return[t,n,""+r.format("h:mm")+" - "+o.format("h:mm a")]}var a=e.start.date,t=moment(a).format("ddd"),n=moment(a).format("D");return[t,n,"All day"]}function getCreator(e){var t;return t=e.creator.email?e.creator.email:e.organizer.email}function getLocation(e){var t;return t=e.location?e.location:"New York"}function getSortIndex(e){var t;t=e.start.dateTime?moment(e.start.dateTime):moment(e.start.date);var n=t.format("DD")+t.format("HH mm");return parseInt(n)}function buildEvents(e){for(var t=0;t<e.length;t++){var n=e[t],r=n.summary,o=getDisplayTime(n)[0],a=getDisplayTime(n)[1],i=getDisplayTime(n)[2],s=getLocation(n),m=getCreator(n),c=n.organizer.displayName,l=getSortIndex(n);Events.push(new Event(r,o,a,i,s,m,c,l))}}function listAllEvents(){listUpcomingPrimaryEvents(),listUpcomingSupportEvents(),listUpcomingCreativeConnectionsEvents(),setTimeout(function(){sortEventsByTime(),renderEvents(10),fetchImages()},2e3)}var Events=[],Images=[],Calendars={own:"primary",support:"ideo.com_p0gg0riugm6d554et1jic6okrg@group.calendar.google.com",creativeConnections:"ideo.com_20hjl85r7mi3e2vtfncskfiabs@group.calendar.google.com",internal:"ideo.com_3ksmp10u6g268lutghfpb8bkl4@group.calendar.google.com",external:"ideo.com_20hjl85r7mi3e2vtfncskfiabs@group.calendar.google.com",projects:"ideo.com_v4vpo5b47up8803v4omofvet4c@group.calendar.google.com"},UI={tmpl:document.getElementById("event-template"),eventContainer:document.getElementById("event-container")},Event=function(e,t,n,r,o,a,i,s){this.summary=e,this.day=t,this.date=n,this.time=r,this.creator=a,this.where=o,this.calendar=i,this.sortIndex=s};Event.prototype.getColor=function(){return"NY Support"===this.calendar?"#EA643B":"NY - Creative Connections"===this.calendar?"#4BC4A4":"rgb(0,155,255)"},Event.prototype.handler=function(e){var t=JSON.parse(e.target.response);if(t.results)for(var n=document.querySelectorAll('[data-person="'+t.results[0].email+'"]'),r=0;r<n.length;r++)n[r].src=""+t.results[0].image},Event.prototype.getImage=function(){var e=parseEmail(this.creator);callAjax(e,this.handler)};var fetchImages=function(){for(var e=0;e<Events.length;e++){var t=Events[e];t.getImage()}},parseCreatorName=function(e){return e=e.replace(/\s/g,"")},parseEmail=function(e){return e.substring(0,e.indexOf("@"))},sortEventsByTime=function(){Events.sort(function(e,t){return e.sortIndex-t.sortIndex})},renderEvents=function(e){for(var t=0;e>t;t++){var n=Events[t],r=UI.tmpl.content.cloneNode(!0);(0===t||t>0&&Events[t-1].day!==n.day)&&(r.querySelector(".event-day").innerHTML=n.day,r.querySelector(".event-date").innerHTML=n.date),r.querySelector(".event").id=n.id,r.querySelector(".event-title").innerHTML=n.summary,r.querySelector(".event-location").innerHTML=n.where,r.querySelector(".event-time").innerHTML=n.time,r.querySelector("img").setAttribute("data-person",n.creator),r.querySelector(".event-info").style.background=n.getColor(),UI.eventContainer.appendChild(r)}},getRequest=function(e){var t=gapi.client.calendar.events.list({calendarId:e,timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:15,orderBy:"startTime"});return t},listUpcomingPrimaryEvents=function(){getRequest(Calendars.own).execute(function(e){buildEvents(e.items)})},listUpcomingSupportEvents=function(){getRequest(Calendars.support).execute(function(e){buildEvents(e.items)})},listUpcomingCreativeConnectionsEvents=function(){getRequest(Calendars.creativeConnections).execute(function(e){buildEvents(e.items)})};setInterval(function(){Events=[],listAllEvents()},3e4);