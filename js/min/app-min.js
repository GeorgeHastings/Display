"use strict";function callAjax(e,t){var r=new XMLHttpRequest;r.onload=t,r.open("GET","http://localhost:1235/api/teammembers?limit=10&offset=0&email="+e+"%40ideo.com"),r.send()}var Events=[],OutOfOffice=[],OutOfOfficeImages=[],Calendars={internal:"ideo.com_p0gg0riugm6d554et1jic6okrg@group.calendar.google.com",external:"ideo.com_20hjl85r7mi3e2vtfncskfiabs@group.calendar.google.com",projects:"ideo.com_v4vpo5b47up8803v4omofvet4c@group.calendar.google.com",ooo:"ideo.com_bdpb36toirhifucfijthud9dng@group.calendar.google.com",visitors:"ideo.com_34qgi5b59dtf8ljfls0ojtj804@group.calendar.google.com"},UI={tmpl:document.getElementById("event-template"),eventContainer:document.getElementById("event-container")},Event=function(e,t,r,a,n,o,i,s,m){this.summary=e,this.day=t,this.date=r,this.time=a,this.creator=o,this.where=n,this.calendar=i,this.sortIndex=s,this.dateMonthDay=m};Event.prototype.getColor=function(){return"NY Support"===this.calendar?"#33AD9B":"NY - Internal Events"===this.calendar||"NY - Internal"===this.calendar?"#64BDE3":"NY - OOO"===this.calendar||"NYC Staff Vacations"===this.calendar?"brown":"NY - Visitors"===this.calendar?"#F37F82":"NY - External Events"===this.calendar?"#9BCE7A":"NY - Client Events"===this.calendar||"NY - Projects"===this.calendar?"#F6A23E":"black"};var handler=function(e){var t=JSON.parse(e.target.response);if(t.results)for(var r=document.querySelectorAll('[data-person="'+t.results[0].email+'"]'),a=0;a<r.length;a++)r[a].src=""+t.results[0].image};Event.prototype.getImage=function(){var e=parseEmail(this.creator);callAjax(e,this.handler)};var fetchImages=function(){for(var e=0;e<OutOfOfficeImages.length;e++){var t=parseEmail(OutOfOfficeImages[e]);callAjax(t,handler)}},parseCreatorName=function(e){return e=e.replace(/\s/g,"")},parseEmail=function(e){return e.substring(0,e.indexOf("@"))},sortEventsByTime=function(){Events.sort(function(e,t){return e.sortIndex-t.sortIndex})},renderOutOfOffice=function(e){for(var t="",r=0;r<OutOfOffice.length;r++)getSortIndex(OutOfOffice[r])<e.sortIndex&&getDisplayTime(OutOfOffice[r])[3]>e.dateMonthDay&&(t+='<img data-person="'+OutOfOffice[r].attendees[0].email+'">',OutOfOfficeImages.push(OutOfOffice[r].attendees[0].email));return t},renderEvents=function(e){for(var t=0;e>t;t++){var r=Events[t],a=UI.tmpl.content.cloneNode(!0);(0===t||t>0&&Events[t-1].day!==r.day)&&(a.querySelector(".date-container").style.display="block",a.querySelector(".event-date").innerHTML=r.day+" "+r.date,a.querySelector(".ooo-container").innerHTML=renderOutOfOffice(r)),a.querySelector(".event").id=r.id,a.querySelector(".event-title").innerHTML=r.summary,a.querySelector(".event-location").innerHTML=r.where,a.querySelector(".event-time").innerHTML=r.time,"All day"===r.time&&(a.querySelector(".event").className+=" all-day"),UI.eventContainer.appendChild(a)}},getEventDay=function(e){var t;return t=e.start.dateTime?e.start.dateTime:e.start.date,moment(t)},getDisplayTime=function(e){if(e.start.dateTime){var t=moment(e.start.dateTime).format("dddd"),r=moment(e.start.dateTime).format("M/D"),a=moment(e.start.dateTime),n=moment(e.end.dateTime),o=moment(e.start.dateTime).format("MDD");return[t,r,""+a.format("h:mm")+" - "+n.format("h:mm a"),o]}var i=e.start.date,n=moment(e.end.date).format("MDD"),t=moment(i).format("ddd"),r=moment(i).format("D"),o=moment(e.start.date).format("MDD");return[t,r,"All day",n]},getCreator=function(e){var t;return t=e.creator.email?e.creator.email:e.organizer.email},getLocation=function(e){var t;return t=e.location?e.location:"New York"},getSortIndex=function(e){var t;t=e.start.dateTime?moment(e.start.dateTime):moment(e.start.date);var r=t.format("MM")+t.format("DD")+t.format("HH mm");return parseInt(r)},buildEvents=function(e){for(var t=0;t<e.length;t++){var r=e[t],a=r.summary,n=getDisplayTime(r)[0],o=getDisplayTime(r)[1],i=getDisplayTime(r)[2],s=getDisplayTime(r)[3],m=getLocation(r),l=getCreator(r),c=r.organizer.displayName,d=getSortIndex(r);Events.push(new Event(a,n,o,i,m,l,c,d,s))}},buildOutOfOffice=function(e){for(var t=0;t<e.length;t++){var r=e[t];OutOfOffice.push(r)}},getRequest=function(e){var t=gapi.client.calendar.events.list({calendarId:e,timeMin:(new Date).toISOString(),showDeleted:!1,singleEvents:!0,maxResults:10,orderBy:"startTime"});return t},listUpComingEvents=function(e){getRequest(Calendars[e]).execute(function(e){"NY - OOO"===e.summary?buildOutOfOffice(e.items):buildEvents(e.items)})},listAllEvents=function(){for(var e in Calendars)listUpComingEvents(e);setTimeout(function(){sortEventsByTime(),renderEvents(15),fetchImages()},2e3)};